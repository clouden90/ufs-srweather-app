#Setup instructions for Orion using Intel-18.0.5 (bash shell)

#
module purge
module load contrib noaatools
module load cmake/3.22.1
module load python/3.7.5
module use /apps/contrib/NCEP/libs/hpc-stack/modulefiles/stack
module load hpc/1.1.0
module load hpc-intel/2018.4
module load hpc-impi/2018.4
#module load ufs_common

#
module load nemsio/2.5.2
module load sfcio/1.4.1
module load sigio/2.3.2
module load wgrib2/2.0.8
module load nemsio/2.5.2
module load g2/3.4.3

#
module load g2tmpl/1.10.0
module load fms/2022.01
module load crtm/2.3.0
module load ip/3.3.3
module load sp/2.3.3
module load esmf/8.3.0b09
module load netcdf/4.7.4-parallel
module load pnetcdf

export CC=mpiicc
export CXX=mpiicpc
export FC=mpiifort
export CMAKE_Platform=orion.intel
export I_MPI_DAPL_UD=1

export SRW_ENV=regional_workflow
export MPI_EXE=srun
export LIB_Z_PATH=/apps/contrib/NCEP/libs/hpc-stack/intel-2018.4/zlib/1.2.11/lib
export LIB_PNG_PATH=/apps/contrib/NCEP/libs/hpc-stack/intel-2018.4/png/1.6.35/lib64
export LIB_JASPER_PATH=/apps/contrib/NCEP/libs/hpc-stack/intel-2018.4/jasper/2.0.25/lib64
export HDF5=/apps/intel-2018/hdf5-1.10.6-parallel

module load contrib rocoto
module use -a /apps/contrib/miniconda3-noaa-gsl/modulefiles
module load miniconda3/3.8
conda activate regional_workflow

#
pip3 install f90nml --user
pip3 install netcdf4 --user
pip3 install configobj --user
pip3 install matplotlib --user
pip3 install pandas --user
pip3 install jinja2 --user
pip3 install pyyaml --user
pip3 install basemap --user
export PYTHONPATH=/home/${USER}/.local/lib/python3.8/site-packages:$PYTHONPATH
export PYTHONPATH=/home/${USER}/.local/lib/python3.9/site-packages:$PYTHONPATH

#
if [ -d "/home/${USER}/aws-cli" ]; then
   echo "aws-cli existed" 
else
   CURRENT_FOLDER=${PWD}
   cd
   curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64-2.0.30.zip" -o "awscliv2.zip"
   unzip awscliv2.zip
   ./aws/install -i /home/${USER}/aws-cli -b /home/${USER}/aws-cli/bin
   cd ${CURRENT_FOLDER}
fi
export PATH=/home/${USER}/aws-cli/bin:$PATH
