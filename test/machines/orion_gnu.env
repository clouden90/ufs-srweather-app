#Setup instructions for Orion using gnu10.2 (bash shell)

#
module purge
module load contrib noaatools
module load cmake/3.22.1
module load python/3.7.5
module load gcc/10.2.0
module load mpich/3.3.2
module use /work/noaa/epic-ps/jongkim/tools/hpc-stack-1.2.0/modulefiles/stack
module load hpc/1.2.0
module load hpc-gcc/10.2.0
module load hpc-mpich/3.3.2

#
module load netcdf/4.7.4
module load hdf5/1.10.6 
module load nemsio/2.5.2
module load sfcio/1.4.1
module load sigio/2.3.2
module load wgrib2/2.0.8
module load nemsio/2.5.2
module load g2/3.4.2
module load g2c/1.6.2
module load w3nco/2.4.1

#
module load g2tmpl/1.10.0
module load fms/2022.01
module load crtm/2.3.0
module load ip/3.3.3
module load sp/2.3.3
module load esmf/8.3.0b09

export CC=mpicc
export CXX=mpicxx
export FC=mpif90
export CMAKE_Platform=orion.gnu
export I_MPI_DAPL_UD=1

export SRW_ENV=regional_workflow
export MPI_EXE=srun

module load contrib rocoto
module use -a /apps/contrib/miniconda3-noaa-gsl/modulefiles
module load miniconda3/3.8
conda activate regional_workflow

#
pip3 install f90nml --user
pip3 install netcdf4 --user
pip3 install configobj --user
pip3 install matplotlib --user
pip3 install pandas --user
pip3 install jinja2 --user
pip3 install pyyaml --user
export PYTHONPATH=/home/${USER}/.local/lib/python3.8/site-packages:$PYTHONPATH
export PYTHONPATH=/home/${USER}/.local/lib/python3.9/site-packages:$PYTHONPATH

#
if [ -d "/home/${USER}/aws-cli" ]; then
   echo "aws-cli existed" 
else
   CURRENT_FOLDER=${PWD}
   cd
   curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64-2.0.30.zip" -o "awscliv2.zip"
   unzip awscliv2.zip
   ./aws/install -i /home/${USER}/aws-cli -b /home/${USER}/aws-cli/bin
   cd ${CURRENT_FOLDER}
fi
export PATH=/home/${USER}/aws-cli/bin:$PATH
